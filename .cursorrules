# R√®gles de Projet Cursor - Ring General

## üìã Contexte du Projet

**Nom** : Ring General  
**Type** : Simulateur de gestion de catch professionnel (Wrestling Management Simulator)  
**Plateforme** : Application Desktop multiplateforme (Windows, macOS, Linux)

### Stack Technique

- **Langage** : C# 12
- **Framework** : .NET 8.0 LTS
- **UI Framework** : Avalonia UI 11.0.6
- **Reactive UI** : ReactiveUI (via Avalonia)
- **Base de donn√©es** : SQLite 8.0.0
- **Dependency Injection** : Microsoft.Extensions.DependencyInjection 8.0.0
- **Architecture** : MVVM avec architecture en couches (Layered Architecture)

---

## üèóÔ∏è Architecture en Couches

Le projet suit une architecture en couches stricte avec s√©paration claire des responsabilit√©s :

```
RingGeneral.UI (Pr√©sentation)
  ‚îú‚îÄ> RingGeneral.Core (Logique M√©tier)
  ‚îú‚îÄ> RingGeneral.Data (Acc√®s Donn√©es)
  ‚îî‚îÄ> RingGeneral.Specs (Configuration)

RingGeneral.Data
  ‚îú‚îÄ> RingGeneral.Core
  ‚îî‚îÄ> RingGeneral.Specs

RingGeneral.Core
  ‚îî‚îÄ> RingGeneral.Specs

RingGeneral.Specs
  ‚îî‚îÄ> (Aucune d√©pendance)
```

### Projets de la Solution

- **RingGeneral.UI** : Couche pr√©sentation (Views, ViewModels, Services UI)
- **RingGeneral.Core** : Logique m√©tier (Models, Services, Simulation, Interfaces)
- **RingGeneral.Data** : Acc√®s aux donn√©es (Repositories, Database, Migrations)
- **RingGeneral.Specs** : Configuration JSON (mod√®les et services de chargement)
- **RingGeneral.Tools.BakiImporter** : Outil CLI pour import BAKI
- **RingGeneral.Tools.DbManager** : Utilitaires de gestion DB
- **RingGeneral.Tests** : Projet de tests (actuellement vide)

### R√®gles de D√©pendances

‚úÖ **Autoris√©** :
- UI ‚Üí Core, Data, Specs
- Data ‚Üí Core, Specs
- Core ‚Üí Specs uniquement
- Tools ‚Üí Core, Data, Specs
- Tests ‚Üí Core, Data, Specs

‚ùå **Interdit** :
- D√©pendances circulaires
- Core ‚Üí UI ou Data
- Specs ‚Üí Autre projet
- Data ‚Üí UI

---

## üéØ Conventions MVVM Strictes

### Structure MVVM

#### Models (RingGeneral.Core/Models/)
- **Type** : `sealed record` (immuables)
- **Localisation** : `src/RingGeneral.Core/Models/`
- **Exemples** : `WorkerSnapshot`, `ShowDefinition`, `SegmentDefinition`, `StorylineInfo`
- **R√®gles** :
  - Records immuables uniquement
  - Pas de logique m√©tier dans les models
  - Propri√©t√©s publiques en fran√ßais (PascalCase)

#### ViewModels (RingGeneral.UI/ViewModels/)
- **Type** : Classes h√©ritant de `ViewModelBase` (qui h√©rite de `ReactiveObject`)
- **Localisation** : `src/RingGeneral.UI/ViewModels/` organis√©s par domaine
- **Exemples** : `BookingViewModel`, `RosterViewModel`, `DashboardViewModel`
- **R√®gles** :
  - H√©riter de `ViewModelBase` (fournit `ILoggingService Logger`)
  - Utiliser `RaiseAndSetIfChanged(ref _field, value)` pour les propri√©t√©s
  - Utiliser `ReactiveCommand` pour les commandes
  - Injection de d√©pendances via constructeur
  - Pas de r√©f√©rences aux Views

#### Views (RingGeneral.UI/Views/)
- **Type** : Fichiers AXAML avec code-behind minimal
- **Localisation** : `src/RingGeneral.UI/Views/`
- **R√®gles** :
  - Code-behind contient UNIQUEMENT `InitializeComponent()`
  - Pas de logique m√©tier dans le code-behind
  - Data binding exclusif via XAML
  - Pas d'√©v√©nements dans code-behind (utiliser les commandes du ViewModel)

#### Services
- **Services M√©tier** : `src/RingGeneral.Core/Services/`
- **Services UI** : `src/RingGeneral.UI/Services/`
- **R√®gles** :
  - Services stateless (pas d'√©tat mutable)
  - Injection de d√©pendances obligatoire
  - Interfaces dans `RingGeneral.Core/Interfaces/`

### R√®gles MVVM Strictes

‚ùå **JAMAIS** :
- Logique m√©tier dans les Views
- R√©f√©rences aux Views dans les ViewModels
- Instanciation manuelle de services (`new Service()`) dans les ViewModels
- Acc√®s direct √† la DB depuis les ViewModels
- Code-behind avec logique (sauf `InitializeComponent`)

‚úÖ **TOUJOURS** :
- Data binding via ReactiveUI
- Dependency Injection pour toutes les d√©pendances
- Navigation via `INavigationService` (pas de r√©f√©rences directes aux Views)
- Logique m√©tier dans les Services
- Validation dans les Services ou Validators

---

## üìù Conventions de Nommage

### Types et Classes
- **Format** : PascalCase en anglais
- **Exemples** : `WorkerSnapshot`, `BookingViewModel`, `ShowSimulationEngine`
- **Interfaces** : Pr√©fixe `I` + PascalCase (`IRepository`, `INavigationService`)

### Propri√©t√©s Publiques
- **Format** : PascalCase en fran√ßais
- **Exemples** : `NomComplet`, `Popularite`, `Fatigue`, `Momentum`, `Morale`

### Champs Priv√©s
- **Format** : camelCase avec underscore pr√©fixe
- **Exemples** : `_gameRepository`, `_selectedTabIndex`, `_currentCompany`

### M√©thodes
- **Format** : PascalCase en fran√ßais pour m√©thodes publiques
- **Exemples** : `ChargerDonnees()`, `Sauvegarder()`, `ValiderSegment()`

### Namespaces
- **R√®gle CRITIQUE** : Le namespace DOIT correspondre EXACTEMENT au chemin du fichier
- **Exemple** :
  ```csharp
  // Fichier : src/RingGeneral.UI/ViewModels/Booking/BookingViewModel.cs
  namespace RingGeneral.UI.ViewModels.Booking;
  
  // Fichier : src/RingGeneral.Core/Models/WorkerSnapshot.cs
  namespace RingGeneral.Core.Models;
  ```
- **V√©rification** : Toujours v√©rifier apr√®s d√©placement/renommage de fichiers

### Fichiers
- **Classes** : Un fichier par classe, nom du fichier = nom de la classe
- **Records** : Un fichier par record
- **Enums** : Un fichier par enum dans `RingGeneral.Core/Enums/`

---

## üîß Patterns et Conventions C#

### Records Immuables
- **Utilisation** : Tous les mod√®les du domaine utilisent `sealed record`
- **Exemple** :
  ```csharp
  public sealed record WorkerSnapshot(
      string WorkerId,
      string NomComplet,
      int InRing,
      int Entertainment,
      int Story,
      int Popularite);
  ```

### Nullable Reference Types
- **Activ√©** : `<Nullable>enable</Nullable>` dans tous les projets
- **R√®gles** :
  - Utiliser `string?` pour les valeurs nullable
  - Utiliser `int?` pour les entiers nullable
  - V√©rifier les nulls avant utilisation (`?.`, `??`, `!`)

### Dependency Injection
- **Conteneur** : Microsoft.Extensions.DependencyInjection
- **Configuration** : `App.axaml.cs` (m√©thode `OnFrameworkInitializationCompleted`)
- **R√®gles** :
  - Services enregistr√©s comme Singleton ou Transient
  - ViewModels enregistr√©s comme Transient (sauf ShellViewModel = Singleton)
  - Repositories enregistr√©s comme Singleton
  - Injection via constructeur uniquement

### Repository Pattern
- **Interfaces** : `RingGeneral.Core/Interfaces/` (ex: `IWorkerRepository`, `IShowRepository`)
- **Impl√©mentations** : `RingGeneral.Data/Repositories/` (ex: `WorkerRepository`, `ShowRepository`)
- **R√®gles** :
  - Un repository par domaine (23+ repositories sp√©cialis√©s)
  - M√©thodes asynchrones pour op√©rations DB
  - Transactions pour modifications multiples
  - Param√®tres SQL (jamais de concat√©nation)

### ReactiveUI
- **Propri√©t√©s** : Utiliser `RaiseAndSetIfChanged(ref _field, value)`
- **Commandes** : Utiliser `ReactiveCommand.Create()` ou `ReactiveCommand.CreateFromTask()`
- **Collections** : `ObservableCollection<T>` pour listes dynamiques
- **Exemple** :
  ```csharp
  private string _nom = string.Empty;
  public string Nom
  {
      get => _nom;
      set => this.RaiseAndSetIfChanged(ref _nom, value);
  }
  
  public ReactiveCommand<Unit, Unit> SauvegarderCommand { get; }
  ```

### Async/Await
- **R√®gles** :
  - Utiliser `async Task` pour m√©thodes asynchrones
  - Utiliser `ConfigureAwait(false)` dans les libraries (pas dans UI)
  - G√©rer les exceptions avec try-catch

---

## üéØ R√®gles Sp√©cifiques au Projet

### Namespace = Chemin Fichier
- **R√®gle ABSOLUE** : V√©rifier apr√®s chaque modification/d√©placement
- **Outils** : Utiliser File Cleaner si n√©cessaire
- **Exemple d'erreur** :
  ```csharp
  // ‚ùå INCORRECT
  // Fichier : src/RingGeneral.UI/ViewModels/Booking/BookingViewModel.cs
  namespace RingGeneral.UI.ViewModels; // ‚ùå Ne correspond pas !
  
  // ‚úÖ CORRECT
  namespace RingGeneral.UI.ViewModels.Booking;
  ```

### Injection de D√©pendances
- **TOUJOURS** utiliser le conteneur DI
- **JAMAIS** d'instanciation manuelle (`new Service()`) dans les ViewModels
- **Pattern** : Injection via constructeur
- **Exemple** :
  ```csharp
  // ‚úÖ CORRECT
  public sealed class BookingViewModel : ViewModelBase
  {
      private readonly IShowRepository _showRepository;
      
      public BookingViewModel(IShowRepository showRepository)
      {
          _showRepository = showRepository ?? throw new ArgumentNullException(nameof(showRepository));
      }
  }
  
  // ‚ùå INCORRECT
  public sealed class BookingViewModel : ViewModelBase
  {
      private readonly IShowRepository _showRepository = new ShowRepository(); // ‚ùå
  }
  ```

### Logging
- **M√©thode 1** : Via `ApplicationServices.Logger` (dans ViewModelBase)
- **M√©thode 2** : Injection de `ILoggingService` via constructeur
- **Exemple** :
  ```csharp
  protected ViewModelBase()
  {
      Logger = ApplicationServices.Logger; // Disponible automatiquement
  }
  
  // Utilisation
  Logger.Info("Message informatif");
  Logger.Error("Erreur", exception);
  ```

### Base de Donn√©es
- **Param√®tres SQL** : TOUJOURS utiliser des param√®tres (jamais de concat√©nation)
- **Transactions** : Utiliser des transactions pour modifications multiples
- **Exemple** :
  ```csharp
  // ‚úÖ CORRECT
  command.CommandText = "INSERT INTO Workers (Name, Popularite) VALUES (@name, @popularite)";
  command.Parameters.AddWithValue("@name", workerName);
  command.Parameters.AddWithValue("@popularite", popularite);
  
  // ‚ùå DANGEREUX (SQL Injection)
  command.CommandText = $"INSERT INTO Workers (Name) VALUES ('{workerName}')";
  ```

### Fichiers de Specs
- **Localisation** : `/specs` √† la racine du projet
- **Source de v√©rit√©** : Navigation, pages UI, aide/Codex, boucles de jeu
- **R√®gles** :
  - Ne pas modifier les IDs existants (casse les r√©f√©rences)
  - Ajouter du contenu via les fichiers JSON appropri√©s
  - V√©rifier la validit√© JSON avant commit

---

## üìÅ Structure des Fichiers

### ViewModels
Organis√©s par domaine dans `src/RingGeneral.UI/ViewModels/` :
- `Booking/` : BookingViewModel, LibraryViewModel, ShowHistoryPageViewModel
- `Roster/` : RosterViewModel, WorkerDetailViewModel, TitlesViewModel
- `Storylines/` : StorylinesViewModel
- `Finance/` : FinanceViewModel
- `Calendar/` : CalendarViewModel
- `CompanyHub/` : CompanyHubViewModel
- `OwnerBooker/` : OwnerBookerViewModel
- `Crisis/` : CrisisViewModel
- `Medical/` : MedicalViewModel
- `Start/` : StartViewModel, CompanySelectorViewModel, CreateCompanyViewModel
- `Dashboard/` : DashboardViewModel
- `Core/` : ShellViewModel, ViewModelBase

### Repositories
Un repository par domaine dans `src/RingGeneral.Data/Repositories/` :
- `GameRepository` : Gestion partie/sauvegarde
- `WorkerRepository` : Workers/catcheurs
- `ShowRepository` : Shows/√©v√©nements
- `CompanyRepository` : Compagnies
- `TitleRepository` : Titres/ceintures
- `ContractRepository` : Contrats
- `MedicalRepository` : Blessures
- `BackstageRepository` : Syst√®mes backstage
- `ScoutingRepository` : Scouting
- Et 14+ autres repositories sp√©cialis√©s

### Services
Group√©s par responsabilit√© dans `src/RingGeneral.Core/Services/` :
- Services m√©tier : BookingBuilderService, StorylineService, TitleService
- Services simulation : ShowSimulationEngine, FinanceEngine, BackstageService
- Services contrats : ContractNegotiationService, AIContractDecisionService
- Services m√©dicaux : InjuryService, MedicalRecommendations
- Services validation : BookingValidator

### Migrations
- **Localisation** : `data/migrations/`
- **Format** : `001_*.sql`, `002_*.sql`, etc. (num√©rotation s√©quentielle)
- **R√®gles** : Ne jamais modifier une migration existante, cr√©er une nouvelle

---

## ‚úÖ Bonnes Pratiques

### SOLID Principles
- **S**ingle Responsibility : Une classe = une responsabilit√©
- **O**pen/Closed : Ouvert √† l'extension, ferm√© √† la modification
- **L**iskov Substitution : Les interfaces doivent √™tre respect√©es
- **I**nterface Segregation : Interfaces sp√©cifiques plut√¥t que g√©n√©rales
- **D**ependency Inversion : D√©pendre des abstractions, pas des impl√©mentations

### DRY (Don't Repeat Yourself)
- Factoriser le code dupliqu√©
- Utiliser des services partag√©s
- Cr√©er des contr√¥les XAML r√©utilisables
- Extraire les m√©thodes communes

### YAGNI (You Aren't Gonna Need It)
- Impl√©menter uniquement ce qui est demand√©
- Pas de sur-ing√©nierie
- Pas de features "au cas o√π"

### Validation
- Valider les entr√©es avant traitement
- Utiliser `BookingValidator` pour les segments
- Validation m√©tier dans les Services
- Messages d'erreur clairs en fran√ßais

### Error Handling
- Try-catch autour des op√©rations risqu√©es (DB, I/O)
- Logger les erreurs avec contexte
- Afficher des messages utilisateur compr√©hensibles
- Ne pas exposer les d√©tails techniques aux utilisateurs

### S√©curit√©
- Param√®tres SQL uniquement (pas de concat√©nation)
- Valider les entr√©es utilisateur
- G√©rer les nulls correctement
- Transactions pour coh√©rence des donn√©es

---

## üöÄ Commandes Essentielles

### Build et Compilation
```bash
# Build du projet
dotnet build

# Build en Release
dotnet build -c Release

# Nettoyer les outputs
dotnet clean

# Restaurer les packages NuGet
dotnet restore
```

### Ex√©cution
```bash
# Lancer l'application
dotnet run --project src/RingGeneral.UI/RingGeneral.UI.csproj

# Avec hot reload (watch)
dotnet watch run --project src/RingGeneral.UI/RingGeneral.UI.csproj
```

### Tests
```bash
# Ex√©cuter tous les tests
dotnet test

# Tests avec d√©tails
dotnet test --verbosity normal
```

### Publication
```bash
# Publier un ex√©cutable Windows
dotnet publish src/RingGeneral.UI/RingGeneral.UI.csproj -c Release -r win-x64 --self-contained true /p:PublishSingleFile=true

# Publier pour Linux
dotnet publish src/RingGeneral.UI/RingGeneral.UI.csproj -c Release -r linux-x64 --self-contained true /p:PublishSingleFile=true
```

---

## üîÑ Workflow de D√©veloppement

### Ordre d'Impl√©mentation Standard

1. **Models** (`RingGeneral.Core/Models/`)
   - Cr√©er les records immuables
   - D√©finir les propri√©t√©s en fran√ßais

2. **Interfaces** (`RingGeneral.Core/Interfaces/`)
   - D√©finir les contrats des repositories/services

3. **Services** (`RingGeneral.Core/Services/`)
   - Impl√©menter la logique m√©tier
   - Validation et r√®gles m√©tier

4. **Repositories** (`RingGeneral.Data/Repositories/`)
   - Impl√©menter les interfaces
   - Acc√®s aux donn√©es SQLite

5. **ViewModels** (`RingGeneral.UI/ViewModels/`)
   - Logique de pr√©sentation
   - Commandes et propri√©t√©s bindables

6. **Views** (`RingGeneral.UI/Views/`)
   - Fichiers AXAML
   - Data binding vers ViewModel

### Checklist apr√®s Modification

- [ ] V√©rifier que les namespaces correspondent aux chemins de fichiers
- [ ] V√©rifier l'injection de d√©pendances (pas d'instanciation manuelle)
- [ ] Compiler le projet (`dotnet build`)
- [ ] V√©rifier les erreurs de compilation
- [ ] V√©rifier les warnings (corriger si n√©cessaire)
- [ ] Tester l'application (`dotnet run`)

### V√©rifications Critiques

1. **Namespace** : Correspond au chemin du fichier ?
2. **DI** : Toutes les d√©pendances inject√©es via constructeur ?
3. **MVVM** : Pas de logique dans les Views ?
4. **SQL** : Param√®tres utilis√©s (pas de concat√©nation) ?
5. **Nullable** : Types nullable g√©r√©s correctement ?
6. **Compilation** : Le projet compile sans erreurs ?

---

## üìö R√©f√©rences Techniques

### Documentation Externe
- **Avalonia UI** : https://docs.avaloniaui.net/
- **ReactiveUI** : https://www.reactiveui.net/
- **.NET 8.0** : https://learn.microsoft.com/dotnet/
- **C# 12** : https://learn.microsoft.com/dotnet/csharp/

### Documentation Projet
- **Architecture** : `docs/ARCHITECTURE_REVIEW_FR.md`
- **Guide Dev** : `docs/DEV_GUIDE_FR.md`
- **Guide DB** : `docs/DATABASE_GUIDE_FR.md`
- **Guide Import** : `docs/IMPORT_GUIDE_FR.md`
- **Index Docs** : `docs/INDEX.md`

### Fichiers de Configuration
- **Specs Navigation** : `specs/navigation.fr.json`
- **Specs UI** : `specs/ui/pages/*.fr.json`
- **Specs Help** : `specs/help/*.fr.json`

---

## ‚ö†Ô∏è Avertissements Importants

1. **JAMAIS de logique dans les Views** : Toute logique doit √™tre dans les ViewModels ou Services
2. **TOUJOURS v√©rifier les namespaces** : Utiliser File Cleaner si n√©cessaire
3. **TOUJOURS compiler avant de commiter** : `dotnet build` doit r√©ussir
4. **JAMAIS de code dupliqu√©** : Factoriser via services ou helpers
5. **TOUJOURS utiliser l'injection de d√©pendances** : Pas de `new Service()` dans les ViewModels
6. **TOUJOURS utiliser des param√®tres SQL** : Jamais de concat√©nation de cha√Ænes SQL
7. **TOUJOURS g√©rer les nulls** : V√©rifier avant utilisation, utiliser `?.` et `??`

---

## üéØ Objectif Final

Construire **Ring General** comme un simulateur de gestion de catch professionnel avec :

- ‚úÖ Architecture propre et maintenable
- ‚úÖ Interface utilisateur fluide et intuitive
- ‚úÖ Simulation r√©aliste et √©quilibr√©e
- ‚úÖ Contenu riche et captivant
- ‚úÖ Code de qualit√© professionnelle

---

**Version** : 1.0  
**Derni√®re mise √† jour** : 2026-01-08  
**Projet** : Ring General - Wrestling Management Simulator  
**Architecture** : MVVM avec Avalonia UI et architecture en couches
