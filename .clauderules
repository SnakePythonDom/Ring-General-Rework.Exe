# Claude Rules - RingGeneral Feature Builder Profile

## ğŸ“‹ Vue d'ensemble

Ce profil dÃ©finit un workflow de dÃ©veloppement en 3 phases pour construire des features de maniÃ¨re structurÃ©e et cohÃ©rente avec l'architecture existante du projet RingGeneral.

---

## ğŸ¯ Profil : Feature Builder

### Phase 1ï¸âƒ£ : Analyse de la structure

**Objectif** : Comprendre le contexte et identifier les patterns avant toute modification.

#### Actions requises :
1. **Explorer l'architecture existante**
   - Identifier les couches concernÃ©es (Core, Data, UI, Tests, Specs)
   - Localiser les fichiers similaires Ã  la feature demandÃ©e
   - Examiner les patterns de nommage et d'organisation

2. **Analyser les dÃ©pendances**
   - VÃ©rifier les modÃ¨les de domaine dans `Core/Models`
   - Identifier les repositories dans `Data/Repositories`
   - Localiser les ViewModels dans `UI/ViewModels`
   - VÃ©rifier les tests existants dans `tests/`

3. **Documenter les patterns identifiÃ©s**
   - Architecture en couches (Clean Architecture)
   - Patterns de code (Records, Repository, Factory, MVVM)
   - Conventions de nommage (franÃ§ais pour les propriÃ©tÃ©s/mÃ©thodes)
   - Structure des tests (xUnit avec Fact/Theory)

#### Outils Ã  utiliser :
- `Glob` : Pour trouver les fichiers par patterns
- `Grep` : Pour rechercher des patterns de code spÃ©cifiques
- `Read` : Pour examiner les fichiers pertinents
- `Task (subagent_type=Explore)` : Pour l'exploration complexe de la codebase

---

### Phase 2ï¸âƒ£ : Codage avec respect des patterns

**Objectif** : ImplÃ©menter la feature en respectant strictement les patterns identifiÃ©s.

#### Patterns Ã  respecter obligatoirement :

##### ğŸ—ï¸ Architecture
```
src/
â”œâ”€â”€ RingGeneral.Core/        # Logique mÃ©tier, modÃ¨les, interfaces
â”‚   â”œâ”€â”€ Models/              # Records immutables
â”‚   â”œâ”€â”€ Interfaces/          # Contrats d'interface
â”‚   â””â”€â”€ Services/            # Services mÃ©tier
â”œâ”€â”€ RingGeneral.Data/        # AccÃ¨s aux donnÃ©es
â”‚   â”œâ”€â”€ Repositories/        # Pattern Repository
â”‚   â””â”€â”€ Database/            # Gestion SQLite
â”œâ”€â”€ RingGeneral.UI/          # Interface Avalonia
â”‚   â”œâ”€â”€ ViewModels/          # MVVM avec ReactiveUI
â”‚   â””â”€â”€ Views/               # Vues AXAML
â””â”€â”€ RingGeneral.Specs/       # SpÃ©cifications JSON
```

##### ğŸ“¦ ModÃ¨les de domaine (Core/Models)
```csharp
// âœ… Toujours utiliser des records immutables
public sealed record MaNouvelleDonnee(
    string Id,
    string Nom,
    int Valeur,
    string? ProprieteOptionnelle = null);

// âœ… Nommage en franÃ§ais pour les propriÃ©tÃ©s
// âœ… sealed record pour l'immutabilitÃ©
// âœ… Types nullables explicites (string?)
```

##### ğŸ—„ï¸ Repositories (Data/Repositories)
```csharp
// âœ… HÃ©riter de RepositoryBase
public sealed class MonRepository : RepositoryBase
{
    public MonRepository(SqliteConnectionFactory factory) : base(factory) { }

    // âœ… Utiliser WithTransaction pour les opÃ©rations de modification
    public void Ajouter(MaNouvelleDonnee donnee)
    {
        WithTransaction((connexion, transaction) =>
        {
            using var commande = connexion.CreateCommand();
            commande.Transaction = transaction;
            commande.CommandText = "INSERT INTO MaTable (Id, Nom) VALUES ($id, $nom);";
            AjouterParametre(commande, "$id", donnee.Id);
            AjouterParametre(commande, "$nom", donnee.Nom);
            commande.ExecuteNonQuery();
        });
    }

    // âœ… Utiliser les helpers protÃ©gÃ©s (AjouterParametre, LireJson, etc.)
}
```

##### ğŸ¨ ViewModels (UI/ViewModels)
```csharp
// âœ… HÃ©riter de ViewModelBase (qui hÃ©rite de ReactiveObject)
public sealed class MonViewModel : ViewModelBase
{
    private string _propriete = string.Empty;

    // âœ… PropriÃ©tÃ©s observables avec RaiseAndSetIfChanged
    public string Propriete
    {
        get => _propriete;
        set => this.RaiseAndSetIfChanged(ref _propriete, value);
    }

    // âœ… Commandes ReactiveUI
    public ReactiveCommand<Unit, Unit> MonAction { get; }

    public MonViewModel()
    {
        MonAction = ReactiveCommand.Create(ExecuterAction);
    }

    private void ExecuterAction()
    {
        // Logique
    }
}
```

##### ğŸ§ª Tests (tests/RingGeneral.Tests)
```csharp
// âœ… Tests xUnit avec [Fact] ou [Theory]
public sealed class MaFeatureTests
{
    [Fact]
    public void MaMethode_QuandCondition_DoitRetournerResultat()
    {
        // Arrange
        var dbPath = Path.Combine(Path.GetTempPath(), $"ringgeneral_{Guid.NewGuid():N}.db");
        var factory = new SqliteConnectionFactory($"Data Source={dbPath}");

        // Act
        var resultat = service.ExecuterOperation();

        // Assert
        Assert.NotNull(resultat);
        Assert.Equal(valeurAttendue, resultat.Propriete);
    }
}
```

#### Principes de codage :
- âœ… **ImmutabilitÃ©** : Utiliser `record` et `readonly` partout oÃ¹ c'est possible
- âœ… **Null safety** : Types nullables explicites (`string?`, `int?`)
- âœ… **Nommage franÃ§ais** : PropriÃ©tÃ©s et mÃ©thodes en franÃ§ais, cohÃ©rent avec le code existant
- âœ… **Transactions SQL** : Toujours utiliser `WithTransaction` pour les modifications
- âœ… **ParamÃ¨tres SQL** : Toujours utiliser des paramÃ¨tres (`$param`) pour Ã©viter les injections
- âœ… **Clean Code** : MÃ©thodes courtes, responsabilitÃ© unique
- âœ… **Pas de surengineering** : ImplÃ©menter uniquement ce qui est demandÃ©

#### SÃ©curitÃ© :
- âš ï¸ **Injection SQL** : TOUJOURS utiliser des paramÃ¨tres SQL
- âš ï¸ **Validation** : Valider les entrÃ©es utilisateur
- âš ï¸ **Gestion d'erreurs** : Try-catch appropriÃ©s avec transactions

---

### Phase 3ï¸âƒ£ : Tests automatiques

**Objectif** : Valider la feature avec des tests unitaires et une exÃ©cution terminale.

#### Actions requises :

1. **CrÃ©er les tests unitaires**
   - Un test par scÃ©nario principal
   - Pattern Arrange-Act-Assert
   - Utiliser des bases de donnÃ©es temporaires
   - Nommer les tests : `Methode_QuandCondition_DoitFaireAction`

2. **ExÃ©cuter les tests**
   ```bash
   # ExÃ©cuter tous les tests
   dotnet test tests/RingGeneral.Tests/RingGeneral.Tests.csproj

   # ExÃ©cuter un test spÃ©cifique
   dotnet test --filter "FullyQualifiedName~MaFeatureTests"
   ```

3. **VÃ©rifier la compilation**
   ```bash
   # Build complet
   dotnet build RingGeneral.sln

   # Build de la solution en Release
   dotnet build RingGeneral.sln -c Release
   ```

4. **Rapport de rÃ©sultats**
   - Afficher les rÃ©sultats des tests
   - Corriger les erreurs si nÃ©cessaire
   - Confirmer que tous les tests passent âœ…

#### CritÃ¨res de validation :
- âœ… Tous les tests passent
- âœ… Aucune erreur de compilation
- âœ… Aucun warning critique
- âœ… Code respecte les patterns identifiÃ©s en Phase 1

---

## ğŸ”„ Workflow complet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEMANDE DE FEATURE                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 1 : ANALYSE                                           â”‚
â”‚  â€¢ Explorer la structure                                     â”‚
â”‚  â€¢ Identifier les patterns                                   â”‚
â”‚  â€¢ Localiser les fichiers pertinents                         â”‚
â”‚  â€¢ Documenter les dÃ©cisions                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 2 : CODAGE                                            â”‚
â”‚  â€¢ CrÃ©er/modifier les modÃ¨les (Core)                         â”‚
â”‚  â€¢ ImplÃ©menter les repositories (Data)                       â”‚
â”‚  â€¢ CrÃ©er les ViewModels (UI)                                 â”‚
â”‚  â€¢ Respecter TOUS les patterns identifiÃ©s                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 3 : TESTS                                             â”‚
â”‚  â€¢ CrÃ©er les tests unitaires                                 â”‚
â”‚  â€¢ ExÃ©cuter : dotnet test                                    â”‚
â”‚  â€¢ VÃ©rifier : dotnet build                                   â”‚
â”‚  â€¢ Corriger si nÃ©cessaire                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… FEATURE COMPLÃˆTE ET VALIDÃ‰E                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š RÃ©fÃ©rences rapides

### Commandes utiles
```bash
# Tests
dotnet test tests/RingGeneral.Tests/RingGeneral.Tests.csproj
dotnet test --filter "FullyQualifiedName~NomDuTest"

# Build
dotnet build RingGeneral.sln
dotnet build -c Release

# Restaurer les packages
dotnet restore

# ExÃ©cuter l'application
dotnet run --project src/RingGeneral.UI/RingGeneral.UI.csproj
```

### Helpers RepositoryBase disponibles
- `AjouterParametre(commande, nom, valeur)` : Ajoute un paramÃ¨tre SQL
- `WithTransaction(action)` : ExÃ©cute une action dans une transaction
- `LireJson<T>(reader, index)` : DÃ©sÃ©rialise JSON depuis SQLite
- `SerializeJson<T>(value)` : SÃ©rialise en JSON pour SQLite
- `TableExiste(connexion, table)` : VÃ©rifie l'existence d'une table
- `ColonneExiste(connexion, table, colonne)` : VÃ©rifie l'existence d'une colonne
- `AjouterColonneSiAbsente(connexion, table, colonne, type)` : Migration de schÃ©ma

### Structure des specs JSON
```json
{
  "version": "1.0",
  "items": [
    {
      "id": "UNIQUE-ID",
      "nom": "Nom descriptif",
      "propriete": "valeur"
    }
  ]
}
```

---

## âš¡ Mode d'emploi

Quand vous utilisez Claude avec ce profil :

1. **Mentionner explicitement** : "Utilise le profil Feature Builder"
2. Claude suivra automatiquement les 3 phases
3. Claude crÃ©era un TODO list pour tracker la progression
4. Ã€ la fin, vous aurez :
   - Code implÃ©mentÃ© selon les patterns
   - Tests unitaires passants
   - Build sans erreur
   - Rapport de validation

---

## ğŸ“ Exemples de demandes

**âœ… Bonne demande :**
> "Utilise le profil Feature Builder pour ajouter une gestion des blessures multiples pour les workers"

**âœ… Bonne demande :**
> "Feature Builder : Je veux ajouter un systÃ¨me de notation pour les storylines"

**âŒ Demande vague :**
> "AmÃ©liore le systÃ¨me de booking"
> â†’ PrÃ©cisez : quel aspect ? quelle fonctionnalitÃ© ?

---

## ğŸ”’ RÃ¨gles de sÃ©curitÃ©

- âŒ **JAMAIS** de SQL brut avec interpolation de chaÃ®ne
- âœ… **TOUJOURS** utiliser des paramÃ¨tres SQL (`$param`)
- âœ… **TOUJOURS** valider les entrÃ©es utilisateur
- âœ… **TOUJOURS** utiliser des transactions pour les modifications
- âœ… **TOUJOURS** gÃ©rer les erreurs avec try-catch appropriÃ©s
- âŒ **JAMAIS** commit de secrets ou credentials
- âŒ **JAMAIS** de code qui contourne la sÃ©curitÃ©

---

## ğŸ“ Notes importantes

- Le projet utilise **.NET 8.0**
- Framework UI : **Avalonia** avec **ReactiveUI**
- Base de donnÃ©es : **SQLite** avec **Microsoft.Data.Sqlite**
- Tests : **xUnit**
- Langage : **C# 12** avec nullable reference types activÃ©
- Conventions : **Nommage franÃ§ais** pour les propriÃ©tÃ©s et mÃ©thodes

---

**Version** : 1.0
**DerniÃ¨re mise Ã  jour** : 2026-01-07
**Projet** : RingGeneral - Simulateur de promotion de wrestling
