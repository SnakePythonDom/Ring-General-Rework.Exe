<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.DataGrid"
        mc:Ignorable="d"
        x:Class="RingGeneral.UI.Views.MainWindow"
        Width="1280"
        Height="720"
        Title="Ring General">
  <Window.KeyBindings>
    <KeyBinding Gesture="Ctrl+K" Command="{Binding Session.OuvrirRechercheGlobaleCommand}" />
    <KeyBinding Gesture="Escape" Command="{Binding Session.FermerRechercheGlobaleCommand}" />
  </Window.KeyBindings>
  <Grid RowDefinitions="Auto,*" ColumnDefinitions="280,*">
    <Border Grid.Row="0" Grid.ColumnSpan="2" Background="#1F2937" Padding="16,12">
      <DockPanel>
        <TextBlock Text="Ring General" Foreground="White" FontWeight="Bold" DockPanel.Dock="Left" />
        <ItemsControl ItemsSource="{Binding TopbarActions}" DockPanel.Dock="Left" Margin="12,0,0,0">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Button Content="{Binding Libelle}" Tag="{Binding Id}" Margin="4,0,0,0"
                      ToolTip.Tip="{Binding Tooltip}" Click="OnTopbarAction" />
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
        <ItemsControl ItemsSource="{Binding TopbarIndicators}" DockPanel.Dock="Right">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <StackPanel Orientation="Horizontal" />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border Background="#111827" Padding="8,4" Margin="4,0">
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="{Binding Libelle}" Foreground="#9CA3AF" Margin="0,0,6,0" />
                  <TextBlock Text="{Binding Valeur}" Foreground="White" FontWeight="Bold" />
                </StackPanel>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </DockPanel>
    </Border>

    <Border Grid.Row="1" Grid.Column="0" Background="#111827" Padding="12">
      <ScrollViewer>
        <StackPanel Spacing="8">
          <ItemsControl ItemsSource="{Binding Sidebar}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <StackPanel Spacing="4">
                  <Button Content="{Binding Libelle}" Tag="{Binding Route}" Click="OnOuvrirPage"
                          Foreground="White" FontWeight="SemiBold" Background="Transparent"
                          HorizontalContentAlignment="Left" />
                  <ItemsControl ItemsSource="{Binding SousSections}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="#1F2937" Padding="8,6" CornerRadius="6">
                          <Button Content="{Binding Libelle}" Tag="{Binding Route}" Click="OnOuvrirPage"
                                  Foreground="#E5E7EB" Background="Transparent"
                                  HorizontalContentAlignment="Left" />
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </ScrollViewer>
    </Border>

    <Border Grid.Row="1" Grid.Column="1" Background="#0B1220" Padding="24">
      <ScrollViewer>
          <StackPanel Spacing="20">
          <Border Background="#111827" Padding="12" CornerRadius="8" IsVisible="{Binding Session.AideOuverte}">
            <StackPanel Spacing="8">
              <DockPanel>
                <TextBlock Text="{Binding Session.AidePanel.Titre}" Foreground="White" FontWeight="Bold" DockPanel.Dock="Left" />
                <Button Content="Fermer" DockPanel.Dock="Right" Click="OnFermerAide" />
              </DockPanel>
              <TextBlock Text="{Binding Session.AidePanel.Resume}" Foreground="#CBD5F5" TextWrapping="Wrap" />
              <ItemsControl ItemsSource="{Binding Session.AidePanel.Sections}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <StackPanel Spacing="2" Margin="0,6,0,0">
                      <TextBlock Text="{Binding Titre}" Foreground="#F9FAFB" FontWeight="SemiBold" />
                      <TextBlock Text="{Binding Contenu}" Foreground="#D1D5DB" TextWrapping="Wrap" />
                    </StackPanel>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
              <ItemsControl ItemsSource="{Binding Session.AidePanel.ErreursFrequentes}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding .}" Foreground="#FBBF24" TextWrapping="Wrap" />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </Border>

          <StackPanel Spacing="8">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Page sélectionnée" FontSize="20" FontWeight="Bold" Foreground="White" />
              <TextBlock Grid.Column="1" Text="{Binding PageSelectionnee.Meta.PageId}" Foreground="#9CA3AF" />
            </Grid>
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <StackPanel Spacing="8">
                <TextBlock Text="{Binding PageSelectionnee.Meta.Titre}" Foreground="White" FontWeight="SemiBold" />
                <StackPanel Spacing="4">
                  <TextBlock Text="Onglets" Foreground="#9CA3AF" />
                  <ItemsControl ItemsSource="{Binding PageSelectionnee.Onglets}">
                    <ItemsControl.ItemsPanel>
                      <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" />
                      </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="#1F2937" Padding="6,2" CornerRadius="6" Margin="0,0,6,0">
                          <TextBlock Text="{Binding Libelle}" Foreground="#E5E7EB" />
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
                <StackPanel Spacing="4">
                  <TextBlock Text="Filtres" Foreground="#9CA3AF" />
                  <ItemsControl ItemsSource="{Binding PageSelectionnee.Filtres}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding .}" Foreground="#CBD5F5" />
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
                <StackPanel Spacing="4">
                  <TextBlock Text="Tables" Foreground="#9CA3AF" />
                  <ItemsControl ItemsSource="{Binding PageSelectionnee.Tables}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <StackPanel Spacing="2" Margin="0,4,0,0">
                          <TextBlock Text="{Binding Libelle}" Foreground="#F9FAFB" FontWeight="SemiBold" />
                          <ItemsControl ItemsSource="{Binding Colonnes}">
                            <ItemsControl.ItemTemplate>
                              <DataTemplate>
                                <TextBlock Text="{Binding .}" Foreground="#9CA3AF" />
                              </DataTemplate>
                            </ItemsControl.ItemTemplate>
                          </ItemsControl>
                        </StackPanel>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
                <StackPanel Spacing="4">
                  <TextBlock Text="Actions" Foreground="#9CA3AF" />
                  <ItemsControl ItemsSource="{Binding PageSelectionnee.Actions}">
                    <ItemsControl.ItemsPanel>
                      <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" />
                      </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="#1F2937" Padding="6,2" CornerRadius="6" Margin="0,0,6,0">
                          <TextBlock Text="{Binding Libelle}" Foreground="#E5E7EB" />
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
                <StackPanel Spacing="4">
                  <TextBlock Text="Avertissements" Foreground="#9CA3AF" />
                  <ItemsControl ItemsSource="{Binding PageSelectionnee.Warnings}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding .}" Foreground="#FBBF24" />
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
                <StackPanel Spacing="4">
                  <TextBlock Text="État vide" Foreground="#9CA3AF" />
                  <TextBlock Text="{Binding PageSelectionnee.EtatVide}" Foreground="#CBD5F5" />
                </StackPanel>
                <StackPanel Spacing="4">
                  <TextBlock Text="Messages d'erreur" Foreground="#9CA3AF" />
                  <ItemsControl ItemsSource="{Binding PageSelectionnee.MessagesErreur}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding .}" Foreground="#F87171" />
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </StackPanel>
            </Border>
          </StackPanel>

          <StackPanel Spacing="8">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Sauvegardes" FontSize="20" FontWeight="Bold" Foreground="White" />
            </Grid>
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <StackPanel Spacing="8">
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <TextBox Width="220" Watermark="Nom de la sauvegarde" Text="{Binding Saves.NouveauNom, Mode=TwoWay}" />
                  <Button Content="Nouvelle partie" Click="OnNouvelleSauvegarde" />
                  <Button Content="Charger" Click="OnChargerSauvegarde" />
                </StackPanel>
                <ListBox ItemsSource="{Binding Saves.Sauvegardes}" SelectedItem="{Binding Saves.SauvegardeSelectionnee, Mode=TwoWay}" MaxHeight="180">
                  <ListBox.ItemTemplate>
                    <DataTemplate>
                      <Border Background="#1F2937" Padding="8,6" CornerRadius="6">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                          <TextBlock Text="{Binding Nom}" Foreground="White" />
                          <TextBlock Text="{Binding DerniereModificationLabel}" Foreground="#9CA3AF" />
                          <TextBlock Text="Active" Foreground="#34D399" IsVisible="{Binding EstCourante}" />
                        </StackPanel>
                      </Border>
                    </DataTemplate>
                  </ListBox.ItemTemplate>
                </ListBox>
                <StackPanel Orientation="Horizontal" Spacing="8">
                  <Button Content="Exporter base" Click="OnExporterDb" />
                  <Button Content="Importer base" Click="OnImporterDb" />
                  <Button Content="Exporter pack" Click="OnExporterPack" />
                  <Button Content="Importer pack" Click="OnImporterPack" />
                </StackPanel>
                <TextBlock Text="{Binding Saves.StatutMessage}" Foreground="{Binding Saves.StatutCouleur}" TextWrapping="Wrap" />
              </StackPanel>
            </Border>
          </StackPanel>

          <StackPanel Spacing="8">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Booking" FontSize="20" FontWeight="Bold" Foreground="White" />
              <Button Grid.Column="1" Content="?" Tag="page.booking" Click="OnOuvrirAide" ToolTip.Tip="{Binding Session.Tooltips['ui.help']}" />
            </Grid>
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <StackPanel Spacing="6">
                <TextBlock Text="Consignes" Foreground="#F9FAFB" FontWeight="SemiBold" />
                <ItemsControl ItemsSource="{Binding Session.ConsignesBooking}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding .}" Foreground="#CBD5F5" TextWrapping="Wrap" />
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
                <Grid ColumnDefinitions="160,80,*,90,240">
                  <TextBlock Text="Type" Foreground="#9CA3AF" />
                  <TextBlock Grid.Column="1" Text="Durée" Foreground="#9CA3AF" />
                  <TextBlock Grid.Column="2" Text="Participants" Foreground="#9CA3AF" />
                  <TextBlock Grid.Column="3" Text="Main event" Foreground="#9CA3AF" />
                  <TextBlock Grid.Column="4" Text="Actions" Foreground="#9CA3AF" />
                </Grid>
                <ItemsControl ItemsSource="{Binding Session.Segments}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Border Background="#0F172A" Padding="8" CornerRadius="6" Margin="0,4,0,4">
                        <StackPanel Spacing="6">
                          <Grid ColumnDefinitions="160,80,*,90,240">
                            <ComboBox ItemsSource="{Binding DataContext.Session.SegmentTypes, RelativeSource={RelativeSource AncestorType=Window}}"
                                      SelectedValuePath="Id"
                                      DisplayMemberPath="Label"
                                      SelectedValue="{Binding TypeSegment, Mode=TwoWay}" />
                            <TextBox Grid.Column="1" Text="{Binding DureeMinutes, Mode=TwoWay}" />
                            <StackPanel Grid.Column="2" Spacing="4">
                              <ItemsControl ItemsSource="{Binding Participants}">
                                <ItemsControl.ItemTemplate>
                                  <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                      <TextBlock Text="{Binding Nom}" Foreground="#E5E7EB" />
                                      <Button Content="Retirer"
                                              Click="OnRetirerParticipant"
                                              Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=ItemsControl}}" />
                                    </StackPanel>
                                  </DataTemplate>
                                </ItemsControl.ItemTemplate>
                              </ItemsControl>
                              <StackPanel Orientation="Horizontal" Spacing="6">
                                <ComboBox Width="180"
                                          ItemsSource="{Binding DataContext.Session.WorkersDisponibles, RelativeSource={RelativeSource AncestorType=Window}}"
                                          SelectedValuePath="WorkerId"
                                          DisplayMemberPath="Nom"
                                          SelectedValue="{Binding ParticipantSelectionneeId, Mode=TwoWay}" />
                                <Button Content="Ajouter" Click="OnAjouterParticipant" />
                              </StackPanel>
                            </StackPanel>
                            <CheckBox Grid.Column="3" IsChecked="{Binding EstMainEvent, Mode=TwoWay}" />
                            <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="6">
                              <Button Content="↑" Click="OnDeplacerSegmentHaut" />
                              <Button Content="↓" Click="OnDeplacerSegmentBas" />
                              <Button Content="Copier" Click="OnCopierSegment" />
                              <Button Content="Enregistrer" Click="OnEnregistrerSegment" />
                            </StackPanel>
                          </Grid>
                          <TextBlock Text="{Binding Avertissements}" Foreground="#FBBF24" TextWrapping="Wrap" />
                        </StackPanel>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
                <Border Background="#1F2937" Padding="8" CornerRadius="6">
                  <StackPanel Spacing="6">
                    <TextBlock Text="Ajouter un segment" Foreground="#F9FAFB" FontWeight="SemiBold" />
                    <Grid ColumnDefinitions="160,80,*,90,120">
                      <ComboBox ItemsSource="{Binding Session.SegmentTypes}"
                                SelectedValuePath="Id"
                                DisplayMemberPath="Label"
                                SelectedValue="{Binding Session.NouveauSegmentTypeId, Mode=TwoWay}" />
                      <TextBox Grid.Column="1" Text="{Binding Session.NouveauSegmentDuree, Mode=TwoWay}" />
                      <StackPanel Grid.Column="2" Spacing="4">
                        <ItemsControl ItemsSource="{Binding Session.NouveauSegmentParticipants}">
                          <ItemsControl.ItemTemplate>
                            <DataTemplate>
                              <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="{Binding Nom}" Foreground="#E5E7EB" />
                                <Button Content="Retirer" Click="OnRetirerParticipantNouveauSegment" />
                              </StackPanel>
                            </DataTemplate>
                          </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <StackPanel Orientation="Horizontal" Spacing="6">
                          <ComboBox Width="180"
                                    ItemsSource="{Binding Session.WorkersDisponibles}"
                                    SelectedValuePath="WorkerId"
                                    DisplayMemberPath="Nom"
                                    SelectedValue="{Binding Session.NouveauSegmentParticipantId, Mode=TwoWay}" />
                          <Button Content="Ajouter" Click="OnAjouterParticipantNouveauSegment" />
                        </StackPanel>
                      </StackPanel>
                      <CheckBox Grid.Column="3" IsChecked="{Binding Session.NouveauSegmentMainEvent, Mode=TwoWay}" />
                      <Button Grid.Column="4" Content="Ajouter" Click="OnAjouterSegment" />
                    </Grid>
                  </StackPanel>
                </Border>
              </StackPanel>
            </Border>
            <StackPanel Orientation="Horizontal" Spacing="12">
              <Button Content="Simuler le show" Click="OnSimulerShow" ToolTip.Tip="{Binding Session.Tooltips['booking.simuler']}" />
              <Button Content="Semaine suivante" Click="OnSemaineSuivante" ToolTip.Tip="{Binding Session.Tooltips['booking.semaine']}" />
            </StackPanel>
            <TextBlock Text="{Binding Session.ValidationErreurs}" Foreground="#F87171" TextWrapping="Wrap" />
            <TextBlock Text="{Binding Session.ValidationAvertissements}" Foreground="#FBBF24" TextWrapping="Wrap" ToolTip.Tip="{Binding Session.Tooltips['booking.warning']}" />
          </StackPanel>

          <StackPanel Spacing="8">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Résultats" FontSize="20" FontWeight="Bold" Foreground="White" />
              <Button Grid.Column="1" Content="?" Tag="page.resultats" Click="OnOuvrirAide" ToolTip.Tip="{Binding Session.Tooltips['ui.help']}" />
            </Grid>
            <TextBlock Text="{Binding Session.ResumeShow}" Foreground="#CBD5F5" />
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <StackPanel Spacing="6">
                <Grid ColumnDefinitions="120,80,80,*,*">
                  <TextBlock Text="Segment" Foreground="#9CA3AF" />
                  <TextBlock Grid.Column="1" Text="Note" Foreground="#9CA3AF" ToolTip.Tip="{Binding Session.Tooltips['result.note']}" />
                  <TextBlock Grid.Column="2" Text="Icônes" Foreground="#9CA3AF" />
                  <TextBlock Grid.Column="3" Text="Breakdown" Foreground="#9CA3AF" ToolTip.Tip="{Binding Session.Tooltips['result.breakdown']}" />
                  <TextBlock Grid.Column="4" Text="Impacts" Foreground="#9CA3AF" ToolTip.Tip="{Binding Session.Tooltips['result.impacts']}" />
                </Grid>
                <ItemsControl ItemsSource="{Binding Session.Resultats}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Grid ColumnDefinitions="120,80,80,*,*">
                        <TextBlock Text="{Binding TypeSegment}" Foreground="White" />
                        <TextBlock Grid.Column="1" Text="{Binding Note}" Foreground="#FCD34D" ToolTip.Tip="{Binding DataContext.Session.Tooltips['result.note'], RelativeSource={RelativeSource AncestorType=Window}}" />
                        <TextBlock Grid.Column="2" Text="{Binding Icons}" Foreground="#FBBF24" />
                        <TextBlock Grid.Column="3" Text="{Binding Breakdown}" Foreground="#E5E7EB" TextWrapping="Wrap" />
                        <TextBlock Grid.Column="4" Text="{Binding Impacts}" Foreground="#D1D5DB" TextWrapping="Wrap" />
                      </Grid>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </StackPanel>
            </Border>
            <StackPanel Spacing="6">
              <TextBlock Text="Audience" Foreground="#F9FAFB" FontWeight="SemiBold" />
              <TextBlock Text="{Binding Session.AudienceResume}" Foreground="#E5E7EB" />
              <Border Background="#111827" Padding="8" CornerRadius="6">
                <StackPanel Spacing="4">
                  <Grid ColumnDefinitions="80,80,80">
                    <TextBlock Text="Semaine" Foreground="#9CA3AF" />
                    <TextBlock Grid.Column="1" Text="Audience" Foreground="#9CA3AF" />
                    <TextBlock Grid.Column="2" Text="Évolution" Foreground="#9CA3AF" />
                  </Grid>
                  <ItemsControl ItemsSource="{Binding Session.AudienceHistorique}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Grid ColumnDefinitions="80,80,80">
                          <TextBlock Text="{Binding Semaine}" Foreground="#E5E7EB" />
                          <TextBlock Grid.Column="1" Text="{Binding Audience}" Foreground="#FCD34D" />
                          <TextBlock Grid.Column="2" Text="{Binding Evolution}" Foreground="#A7F3D0" />
                        </Grid>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </Border>
            </StackPanel>
            <StackPanel Spacing="6">
              <TextBlock Text="Pourquoi cette note ?" Foreground="#F9FAFB" FontWeight="SemiBold" />
              <ItemsControl ItemsSource="{Binding Session.PourquoiNote}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding .}" Foreground="#E5E7EB" />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
            <StackPanel Spacing="6">
              <TextBlock Text="Récap FM" Foreground="#F9FAFB" FontWeight="SemiBold" />
              <ItemsControl ItemsSource="{Binding Session.RecapFm}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding .}" Foreground="#E5E7EB" TextWrapping="Wrap" />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
            <StackPanel Spacing="6">
              <TextBlock Text="Conseils" Foreground="#F9FAFB" FontWeight="SemiBold" />
              <ItemsControl ItemsSource="{Binding Session.Conseils}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding .}" Foreground="#CBD5F5" TextWrapping="Wrap" />
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
            <StackPanel Spacing="6">
              <Button Content="Détails simulation" Click="OnToggleDetailsSimulation" />
              <TextBlock Text="{Binding Session.DetailsSimulation}" IsVisible="{Binding Session.DetailsSimulationVisible}" Foreground="#9CA3AF" TextWrapping="Wrap" />
            </StackPanel>
            <StackPanel Spacing="6">
              <TextBlock Text="Aller aux impacts" Foreground="#F9FAFB" FontWeight="SemiBold" />
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Popularité" Tag="impacts.popularite" Click="OnOuvrirImpact" />
                <Button Content="Finances" Tag="impacts.finances" Click="OnOuvrirImpact" />
                <Button Content="Fatigue/Blessures" Tag="impacts.fatigue" Click="OnOuvrirImpact" />
                <Button Content="Storylines" Tag="impacts.storylines" Click="OnOuvrirImpact" />
                <Button Content="Titres" Tag="impacts.titres" Click="OnOuvrirImpact" />
              </StackPanel>
            </StackPanel>
          </StackPanel>

          <StackPanel Spacing="8">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Diffusion" FontSize="20" FontWeight="Bold" Foreground="White" />
              <Button Grid.Column="1" Content="?" Tag="page.diffusion" Click="OnOuvrirAide" ToolTip.Tip="{Binding Session.Tooltips['ui.help']}" />
            </Grid>
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <StackPanel Spacing="12">
                <StackPanel Spacing="6">
                  <TextBlock Text="Deals TV" Foreground="#F9FAFB" FontWeight="SemiBold" />
                  <Grid ColumnDefinitions="160,80,80,100,100,*">
                    <TextBlock Text="Diffuseur" Foreground="#9CA3AF" />
                    <TextBlock Grid.Column="1" Text="Reach" Foreground="#9CA3AF" />
                    <TextBlock Grid.Column="2" Text="Cap" Foreground="#9CA3AF" />
                    <TextBlock Grid.Column="3" Text="Fixe" Foreground="#9CA3AF" />
                    <TextBlock Grid.Column="4" Text="Par point" Foreground="#9CA3AF" />
                    <TextBlock Grid.Column="5" Text="Contraintes" Foreground="#9CA3AF" />
                  </Grid>
                  <ItemsControl ItemsSource="{Binding Session.DealsTv}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Grid ColumnDefinitions="160,80,80,100,100,*">
                          <TextBlock Text="{Binding Diffuseur}" Foreground="#E5E7EB" />
                          <TextBlock Grid.Column="1" Text="{Binding ReachBonus}" Foreground="#38BDF8" />
                          <TextBlock Grid.Column="2" Text="{Binding AudienceCap}" Foreground="#FCD34D" />
                          <TextBlock Grid.Column="3" Text="{Binding RevenuBase}" Foreground="#34D399" />
                          <TextBlock Grid.Column="4" Text="{Binding RevenuParPoint}" Foreground="#93C5FD" />
                          <TextBlock Grid.Column="5" Text="{Binding Contraintes}" Foreground="#D1D5DB" TextWrapping="Wrap" />
                        </Grid>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>

                <StackPanel Spacing="6">
                  <TextBlock Text="Reach map" Foreground="#F9FAFB" FontWeight="SemiBold" />
                  <ItemsControl ItemsSource="{Binding Session.ReachMap}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Grid ColumnDefinitions="200,80,*">
                          <TextBlock Text="{Binding Zone}" Foreground="#E5E7EB" />
                          <TextBlock Grid.Column="1" Text="{Binding Reach}" Foreground="#FCD34D" />
                          <TextBlock Grid.Column="2" Text="{Binding Details}" Foreground="#9CA3AF" TextWrapping="Wrap" />
                        </Grid>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>

                <StackPanel Spacing="6">
                  <TextBlock Text="Contraintes" Foreground="#F9FAFB" FontWeight="SemiBold" />
                  <ItemsControl ItemsSource="{Binding Session.ContraintesDiffusion}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding .}" Foreground="#E5E7EB" TextWrapping="Wrap" />
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </StackPanel>
            </Border>
          </StackPanel>

          <StackPanel Spacing="8">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="FM UI Kit · TableView" FontSize="20" FontWeight="Bold" Foreground="White" />
              <Button Grid.Column="1" Content="?" Tag="ui.tableview" Click="OnOuvrirAide" ToolTip.Tip="Présentation de la table virtualisée, tri, filtres et colonnes personnalisables." />
            </Grid>
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <StackPanel Spacing="12">
                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBox Width="240" Watermark="Rechercher dans la table" Text="{Binding Session.TableRecherche, Mode=TwoWay}"
                           ToolTip.Tip="Recherche rapide par nom, rôle, statut ou type." />
                  <ComboBox Width="180" ItemsSource="{Binding Session.TableTypeFilters}" SelectedItem="{Binding Session.TableSelectedTypeFilter, Mode=TwoWay}"
                            DisplayMemberPath="Libelle" ToolTip.Tip="Filtrer par type de fiche." />
                  <ComboBox Width="180" ItemsSource="{Binding Session.TableStatusFilters}" SelectedItem="{Binding Session.TableSelectedStatusFilter, Mode=TwoWay}"
                            DisplayMemberPath="Libelle" ToolTip.Tip="Filtrer par statut opérationnel." />
                  <TextBlock Text="{Binding Session.TableResultatsResume}" Foreground="#9CA3AF" VerticalAlignment="Center" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="Colonnes" Foreground="#9CA3AF" VerticalAlignment="Center" />
                  <CheckBox Content="Type" IsChecked="{Binding Session.TableConfiguration.AfficherType}" ToolTip.Tip="Afficher la colonne Type." />
                  <CheckBox Content="Compagnie" IsChecked="{Binding Session.TableConfiguration.AfficherCompagnie}" ToolTip.Tip="Afficher la colonne Compagnie." />
                  <CheckBox Content="Rôle" IsChecked="{Binding Session.TableConfiguration.AfficherRole}" ToolTip.Tip="Afficher la colonne Rôle/Participants." />
                  <CheckBox Content="Statut" IsChecked="{Binding Session.TableConfiguration.AfficherStatut}" ToolTip.Tip="Afficher la colonne Statut." />
                  <CheckBox Content="Popularité" IsChecked="{Binding Session.TableConfiguration.AfficherPopularite}" ToolTip.Tip="Afficher la colonne Popularité." />
                  <CheckBox Content="Momentum" IsChecked="{Binding Session.TableConfiguration.AfficherMomentum}" ToolTip.Tip="Afficher la colonne Momentum." />
                  <CheckBox Content="Note" IsChecked="{Binding Session.TableConfiguration.AfficherNote}" ToolTip.Tip="Afficher la colonne Note synthétique." />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="12">
                  <TextBlock Text="Actions rapides" Foreground="#9CA3AF" VerticalAlignment="Center" />
                  <Button Content="Assigner" ToolTip.Tip="Assigner la fiche sélectionnée à un segment." />
                  <Button Content="Mettre en avant" ToolTip.Tip="Mettre en avant la fiche dans le show." />
                  <Button Content="Planifier" ToolTip.Tip="Planifier une action rapide." />
                  <Button Content="Favori" ToolTip.Tip="Ajouter aux favoris." />
                </StackPanel>

                <Grid ColumnDefinitions="2*,*" RowDefinitions="Auto">
                  <controls:DataGrid ItemsSource="{Binding Session.TableItemsView}" SelectedItem="{Binding Session.TableSelection, Mode=TwoWay}"
                            Height="320"
                            AutoGenerateColumns="False"
                            CanUserSortColumns="True"
                            GridLinesVisibility="All"
                            HeadersVisibility="All"
                            IsReadOnly="True"
                            EnableRowVirtualization="True"
                            ToolTip.Tip="Table virtualisée avec tri, filtres et recherche.">
                    <controls:DataGrid.Columns>
                      <controls:DataGridTextColumn Header="Nom" Binding="{Binding Nom}" Width="2*" SortMemberPath="Nom" />
                      <controls:DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="*" SortMemberPath="Type"
                                          IsVisible="{Binding DataContext.Session.TableConfiguration.AfficherType, RelativeSource={RelativeSource AncestorType=Window}}" />
                      <controls:DataGridTextColumn Header="Compagnie" Binding="{Binding Compagnie}" Width="*" SortMemberPath="Compagnie"
                                          IsVisible="{Binding DataContext.Session.TableConfiguration.AfficherCompagnie, RelativeSource={RelativeSource AncestorType=Window}}" />
                      <controls:DataGridTextColumn Header="Rôle/Participants" Binding="{Binding Role}" Width="2*" SortMemberPath="Role"
                                          IsVisible="{Binding DataContext.Session.TableConfiguration.AfficherRole, RelativeSource={RelativeSource AncestorType=Window}}" />
                      <controls:DataGridTextColumn Header="Statut" Binding="{Binding Statut}" Width="*" SortMemberPath="Statut"
                                          IsVisible="{Binding DataContext.Session.TableConfiguration.AfficherStatut, RelativeSource={RelativeSource AncestorType=Window}}" />
                      <controls:DataGridTextColumn Header="Popularité" Binding="{Binding Popularite}" Width="*" SortMemberPath="Popularite"
                                          IsVisible="{Binding DataContext.Session.TableConfiguration.AfficherPopularite, RelativeSource={RelativeSource AncestorType=Window}}" />
                      <controls:DataGridTextColumn Header="Momentum" Binding="{Binding Momentum}" Width="*" SortMemberPath="Momentum"
                                          IsVisible="{Binding DataContext.Session.TableConfiguration.AfficherMomentum, RelativeSource={RelativeSource AncestorType=Window}}" />
                      <controls:DataGridTextColumn Header="Note" Binding="{Binding Note}" Width="*" SortMemberPath="Note"
                                          IsVisible="{Binding DataContext.Session.TableConfiguration.AfficherNote, RelativeSource={RelativeSource AncestorType=Window}}" />
                    </controls:DataGrid.Columns>
                  </controls:DataGrid>

                  <Border Grid.Column="1" Background="#0F172A" Padding="12" CornerRadius="8" Margin="12,0,0,0">
                    <StackPanel Spacing="6">
                      <TextBlock Text="Fiche courte" Foreground="#F9FAFB" FontWeight="SemiBold" />
                      <TextBlock Text="{Binding Session.TableSelection.Nom}" Foreground="White" FontSize="16" FontWeight="Bold" />
                      <TextBlock Text="{Binding Session.TableSelection.Type}" Foreground="#CBD5F5" />
                      <TextBlock Text="{Binding Session.TableSelection.Statut}" Foreground="#FCD34D" />
                      <TextBlock Text="{Binding Session.TableSelection.Resume}" Foreground="#D1D5DB" TextWrapping="Wrap" />
                      <ItemsControl ItemsSource="{Binding Session.TableSelection.Etiquettes}">
                        <ItemsControl.ItemsPanel>
                          <ItemsPanelTemplate>
                            <WrapPanel />
                          </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                          <DataTemplate>
                            <Border Background="#1F2937" Padding="6,2" Margin="2" CornerRadius="6">
                              <TextBlock Text="{Binding .}" Foreground="#E5E7EB" />
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                    </StackPanel>
                  </Border>
                </Grid>
              </StackPanel>
            </Border>
          </StackPanel>

          <StackPanel Spacing="8">
            <TextBlock Text="Profil (exemple)" FontSize="20" FontWeight="Bold" Foreground="White" />
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <ItemsControl ItemsSource="{Binding Session.AttributsPrincipaux}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Grid ColumnDefinitions="160,80">
                      <TextBlock Text="{Binding Libelle}" Foreground="#E5E7EB" ToolTip.Tip="{Binding Tooltip}" />
                      <TextBlock Grid.Column="1" Text="{Binding Valeur}" Foreground="#FCD34D" />
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </Border>
          </StackPanel>

          <StackPanel Spacing="8">
            <TextBlock Text="Actions sensibles" FontSize="20" FontWeight="Bold" Foreground="White" />
            <StackPanel Orientation="Horizontal" Spacing="12">
              <Button Content="Buyout" ToolTip.Tip="{Binding Session.Tooltips['action.buyout']}" />
              <Button Content="LOD" ToolTip.Tip="{Binding Session.Tooltips['action.lod']}" />
              <Button Content="Diffusion" ToolTip.Tip="{Binding Session.Tooltips['action.diffusion']}" />
            </StackPanel>
          </StackPanel>

          <StackPanel Spacing="8">
            <TextBlock Text="Génération automatique" FontSize="20" FontWeight="Bold" Foreground="White" />
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <StackPanel Spacing="8">
                <Grid ColumnDefinitions="160,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="6" ColumnSpacing="12">
                  <TextBlock Text="Youth" Foreground="#9CA3AF" />
                  <ComboBox Grid.Column="1"
                            ItemsSource="{Binding Session.YouthGenerationModes}"
                            SelectedItem="{Binding Session.YouthGenerationSelection}">
                    <ComboBox.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding Libelle}" />
                      </DataTemplate>
                    </ComboBox.ItemTemplate>
                  </ComboBox>
                  <TextBlock Grid.Row="1" Text="Monde" Foreground="#9CA3AF" />
                  <ComboBox Grid.Row="1" Grid.Column="1"
                            ItemsSource="{Binding Session.WorldGenerationModes}"
                            SelectedItem="{Binding Session.WorldGenerationSelection}">
                    <ComboBox.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding Libelle}" />
                      </DataTemplate>
                    </ComboBox.ItemTemplate>
                  </ComboBox>
                  <TextBlock Grid.Row="2" Text="Semaine pivot" Foreground="#9CA3AF" />
                  <NumericUpDown Grid.Row="2" Grid.Column="1"
                                 Minimum="1"
                                 Maximum="52"
                                 Value="{Binding Session.SemainePivotAnnuelle}" />
                </Grid>
                <Button Content="Enregistrer les paramètres" Click="OnEnregistrerGeneration" />
                <TextBlock Text="{Binding Session.ParametresGenerationMessage}" Foreground="#34D399" />
              </StackPanel>
            </Border>
          </StackPanel>

          <StackPanel Spacing="8">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Impacts" FontSize="20" FontWeight="Bold" Foreground="White" />
              <Button Grid.Column="1" Content="?" Tag="impacts.popularite" Click="OnOuvrirAide" ToolTip.Tip="{Binding Session.Tooltips['ui.help']}" />
            </Grid>
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <StackPanel Spacing="6">
                <TextBlock Text="{Binding Session.ImpactSelectionnee.Titre}" Foreground="#F9FAFB" FontWeight="SemiBold" />
                <TextBlock Text="{Binding Session.ImpactSelectionnee.Pourquoi}" Foreground="#CBD5F5" TextWrapping="Wrap" />
                <TextBlock Text="{Binding Session.ImpactSelectionnee.CommentAmeliorer}" Foreground="#9CA3AF" TextWrapping="Wrap" />
                <ItemsControl ItemsSource="{Binding Session.ImpactSelectionnee.Deltas}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding .}" Foreground="#E5E7EB" />
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </StackPanel>
            </Border>
          </StackPanel>

          <StackPanel Spacing="8">
            <Grid ColumnDefinitions="*,Auto">
              <TextBlock Text="Aide / Codex" FontSize="20" FontWeight="Bold" Foreground="White" />
              <Button Grid.Column="1" Content="?" Tag="page.aide-codex" Click="OnOuvrirAide" ToolTip.Tip="{Binding Session.Tooltips['ui.help']}" />
            </Grid>
            <StackPanel Spacing="6">
              <TextBox Watermark="Rechercher un terme" Text="{Binding Session.Codex.Recherche, Mode=TwoWay}" ToolTip.Tip="{Binding Session.Tooltips['ui.search']}" />
              <Border Background="#111827" Padding="12" CornerRadius="8">
                <ItemsControl ItemsSource="{Binding Session.Codex.Articles}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="{Binding Titre}" Foreground="#E5E7EB" />
                        <TextBlock Text="{Binding Categorie}" Foreground="#9CA3AF" />
                        <Button Content="Ouvrir" Tag="{Binding Id}" Click="OnOuvrirArticle" ToolTip.Tip="{Binding DataContext.Session.Tooltips['ui.open-article'], RelativeSource={RelativeSource AncestorType=Window}}" />
                      </StackPanel>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </Border>
              <Border Background="#111827" Padding="12" CornerRadius="8">
                <StackPanel Spacing="6">
                  <TextBlock Text="{Binding Session.Codex.ArticleSelectionne.Titre}" Foreground="#F9FAFB" FontWeight="SemiBold" />
                  <TextBlock Text="{Binding Session.Codex.ArticleSelectionne.Contenu}" Foreground="#D1D5DB" TextWrapping="Wrap" />
                  <ItemsControl ItemsSource="{Binding Session.Codex.ArticleSelectionne.Liens}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Button Content="{Binding .}" Tag="{Binding .}" Click="OnOuvrirArticle" />
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </StackPanel>
              </Border>
            </StackPanel>
          </StackPanel>

          <StackPanel Spacing="8">
            <TextBlock Text="Inbox" FontSize="20" FontWeight="Bold" Foreground="White" />
            <Border Background="#111827" Padding="12" CornerRadius="8">
              <ItemsControl ItemsSource="{Binding Session.Inbox}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <StackPanel Spacing="4" Margin="0,0,0,8">
                      <TextBlock Text="{Binding Titre}" Foreground="#F9FAFB" FontWeight="SemiBold" />
                      <TextBlock Text="{Binding Contenu}" Foreground="#E5E7EB" TextWrapping="Wrap" />
                      <TextBlock Text="{Binding Semaine, StringFormat='Semaine {0}'}" Foreground="#9CA3AF" FontSize="11" />
                    </StackPanel>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </Border>
          </StackPanel>
        </StackPanel>
      </ScrollViewer>
    </Border>

    <Border Grid.RowSpan="2" Grid.ColumnSpan="2" Background="#111827EE" IsVisible="{Binding Session.RechercheGlobaleVisible}" ZIndex="10">
      <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Width="720">
        <Border Background="#0B1220" Padding="16" CornerRadius="12" BorderBrush="#1F2937" BorderThickness="1">
          <StackPanel Spacing="12">
            <DockPanel>
              <TextBlock Text="Recherche globale" Foreground="White" FontSize="18" FontWeight="Bold" DockPanel.Dock="Left" />
              <Button Content="Fermer" DockPanel.Dock="Right" Command="{Binding Session.FermerRechercheGlobaleCommand}" ToolTip.Tip="Fermer la recherche globale (Échap)." />
            </DockPanel>
            <TextBox Watermark="Rechercher workers, compagnies, titres ou storylines"
                     Text="{Binding Session.RechercheGlobaleQuery, Mode=TwoWay}"
                     ToolTip.Tip="Tapez un nom, un titre ou un mot-clé." />
            <Border Background="#111827" Padding="8" CornerRadius="8">
              <StackPanel Spacing="6">
                <ItemsControl ItemsSource="{Binding Session.RechercheGlobaleResultats}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Border Background="#0F172A" Padding="8" CornerRadius="6" Margin="0,0,0,6">
                        <Grid ColumnDefinitions="120,*,Auto">
                          <TextBlock Text="{Binding Type}" Foreground="#9CA3AF" />
                          <StackPanel Grid.Column="1">
                            <TextBlock Text="{Binding Titre}" Foreground="White" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding SousTitre}" Foreground="#CBD5F5" />
                          </StackPanel>
                          <TextBlock Grid.Column="2" Text="{Binding Statut}" Foreground="#FCD34D" VerticalAlignment="Center" />
                        </Grid>
                      </Border>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
                <TextBlock Text="Aucun résultat." Foreground="#9CA3AF"
                           IsVisible="{Binding Session.RechercheGlobaleAucunResultat}" />
              </StackPanel>
            </Border>
          </StackPanel>
        </Border>
      </Grid>
    </Border>
  </Grid>
</Window>
