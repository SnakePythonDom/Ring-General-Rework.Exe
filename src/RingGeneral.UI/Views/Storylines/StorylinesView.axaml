<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:RingGeneral.UI.ViewModels.Storylines"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="RingGeneral.UI.Views.Storylines.StorylinesView"
             x:DataType="vm:StorylinesViewModel">

    <Design.DataContext>
        <vm:StorylinesViewModel />
    </Design.DataContext>

    <Grid Margin="30">
        <Grid RowDefinitions="Auto,20,*">

            <!-- En-tÃªte -->
            <StackPanel Grid.Row="0" Spacing="12">
                <StackPanel Spacing="6">
                    <TextBlock Text="ðŸ“– STORYLINES" FontSize="28" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                    <StackPanel Orientation="Horizontal" Spacing="20">
                        <TextBlock FontSize="14" Foreground="{StaticResource SuccessLightBrush}">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} actives">
                                    <Binding Path="TotalActive"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                        <TextBlock FontSize="14" Foreground="{StaticResource AccentOrangeBrush}" IsVisible="{Binding TotalSuspended}">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0} suspendues">
                                    <Binding Path="TotalSuspended"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>

                <!-- Barre de recherche -->
                <TextBox Text="{Binding SearchText, Mode=TwoWay}"
                         Watermark="ðŸ” Rechercher une storyline..."
                         Background="{StaticResource BackgroundSecondaryBrush}"
                         Foreground="{StaticResource TextPrimaryBrush}"
                         Padding="12,8"/>
            </StackPanel>

            <!-- Tabs Storylines -->
            <TabControl Grid.Row="2">

                <!-- Tab Actives -->
                <TabItem Header="ðŸ”¥ ACTIVES">
                    <Grid ColumnDefinitions="2*,20,3*">

                        <!-- Liste gauche -->
                        <Border Grid.Column="0" Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="0">
                            <ListBox ItemsSource="{Binding ActiveStorylines}"
                                     SelectedItem="{Binding SelectedStoryline, Mode=TwoWay}"
                                     Background="Transparent"
                                     BorderThickness="0">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{StaticResource BackgroundTertiaryBrush}" Padding="16,12" Margin="0,0,0,1">
                                            <Grid RowDefinitions="Auto,Auto,Auto">
                                                <TextBlock Grid.Row="0" Text="{Binding Name}" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,3"/>
                                                <Grid Grid.Row="1" ColumnDefinitions="*,Auto" Margin="0,3,0,0">
                                                    <TextBlock Grid.Column="0" Text="{Binding Phase}" FontSize="11" Foreground="{StaticResource TextMutedBrush}"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding HeatDisplay}" FontSize="11" Foreground="{StaticResource AccentOrangeBrush}" FontWeight="SemiBold"/>
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                                <ListBox.Styles>
                                    <Style Selector="ListBoxItem">
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="0"/>
                                    </Style>
                                    <Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
                                        <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                    </Style>
                                    <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                                        <Setter Property="Background" Value="{StaticResource BorderMediumBrush}"/>
                                    </Style>
                                </ListBox.Styles>
                            </ListBox>
                        </Border>

                        <!-- Panneau dÃ©tails droite -->
                        <Border Grid.Column="2" Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="20"
                                IsVisible="{Binding SelectedStoryline, Converter={StaticResource IsNotNullConverter}}">
                            <ScrollViewer>
                                <StackPanel Spacing="20">
                                    <TextBlock Text="{Binding SelectedStoryline.Name}" FontSize="20" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>

                                    <Border Background="{StaticResource WarningDarkBrush}" Padding="16" CornerRadius="8">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBlock Grid.Column="0" Text="HEAT" FontSize="11" Foreground="{StaticResource WarningLightBrush}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="{Binding SelectedStoryline.Heat}" FontSize="32" FontWeight="Bold" Foreground="{StaticResource WarningLightBrush}"/>
                                        </Grid>
                                    </Border>

                                    <StackPanel Spacing="12">
                                        <TextBlock Text="ðŸ‘¥ PARTICIPANTS" FontSize="14" Foreground="{StaticResource TextSubtleBrush}" FontWeight="SemiBold"/>
                                        <ItemsControl ItemsSource="{Binding Participants}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="{StaticResource BackgroundTertiaryBrush}" Padding="12,8" Margin="0,0,0,6" CornerRadius="6">
                                                        <TextBlock Text="{Binding .}" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>

                        <!-- Message si rien sÃ©lectionnÃ© -->
                        <Border Grid.Column="2" Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8"
                                IsVisible="{Binding SelectedStoryline, Converter={StaticResource IsNotNullConverter}, ConverterParameter=Invert}">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                                <TextBlock Text="ðŸ“–" FontSize="48" HorizontalAlignment="Center" Opacity="0.3"/>
                                <TextBlock Text="SÃ©lectionnez une storyline" FontSize="14" Foreground="{StaticResource TextSubtleBrush}" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                    </Grid>
                </TabItem>

                <!-- Tab Suspendues -->
                <TabItem Header="â¸ï¸ SUSPENDUES">
                    <Border Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="20">
                        <ListBox ItemsSource="{Binding SuspendedStorylines}" Background="Transparent" BorderThickness="0">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource BackgroundTertiaryBrush}" Padding="16,12" Margin="0,0,0,8" CornerRadius="6">
                                        <Grid RowDefinitions="Auto,Auto">
                                            <TextBlock Grid.Row="0" Text="{Binding Name}" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock Grid.Row="1" Text="{Binding HeatDisplay}" FontSize="11" Foreground="{StaticResource TextSubtleBrush}"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                </TabItem>

                <!-- Tab TerminÃ©es -->
                <TabItem Header="âœ… TERMINÃ‰ES">
                    <Border Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="20">
                        <ListBox ItemsSource="{Binding CompletedStorylines}" Background="Transparent" BorderThickness="0">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{StaticResource BackgroundTertiaryBrush}" Padding="16,12" Margin="0,0,0,8" CornerRadius="6">
                                        <TextBlock Text="{Binding Name}" FontSize="14" Foreground="{StaticResource TextMutedBrush}"/>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                </TabItem>

            </TabControl>

        </Grid>
    </Grid>

</UserControl>
