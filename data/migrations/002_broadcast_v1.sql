ALTER TABLE TVDeals ADD COLUMN Reach INTEGER NOT NULL DEFAULT 0;
ALTER TABLE TVDeals ADD COLUMN ConstraintsJson TEXT NOT NULL DEFAULT '[]';
ALTER TABLE TVDeals ADD COLUMN RevenuePerPoint REAL NOT NULL DEFAULT 0;

CREATE TABLE IF NOT EXISTS AudienceHistory (
    AudienceHistoryId INTEGER PRIMARY KEY AUTOINCREMENT,
    ShowId TEXT NOT NULL,
    Week INTEGER NOT NULL,
    Audience INTEGER NOT NULL,
    Reach INTEGER NOT NULL DEFAULT 0,
    ShowScore INTEGER NOT NULL DEFAULT 0,
    Stars INTEGER NOT NULL DEFAULT 0,
    Saturation INTEGER NOT NULL DEFAULT 0,
    CreatedAt TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ShowId) REFERENCES Shows(ShowId)
);

CREATE INDEX IF NOT EXISTS idx_audience_history_show_week ON AudienceHistory(ShowId, Week);
