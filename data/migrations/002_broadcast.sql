PRAGMA foreign_keys = ON;

ALTER TABLE TVDeals ADD COLUMN ReachBonus INTEGER NOT NULL DEFAULT 0;
ALTER TABLE TVDeals ADD COLUMN MinimumAudience INTEGER NOT NULL DEFAULT 0;
ALTER TABLE TVDeals ADD COLUMN BaseRevenue REAL NOT NULL DEFAULT 0;
ALTER TABLE TVDeals ADD COLUMN RevenuePerPoint REAL NOT NULL DEFAULT 0;
ALTER TABLE TVDeals ADD COLUMN Penalty REAL NOT NULL DEFAULT 0;
ALTER TABLE TVDeals ADD COLUMN Constraints TEXT;

CREATE TABLE IF NOT EXISTS AudienceHistory (
    AudienceHistoryId INTEGER PRIMARY KEY AUTOINCREMENT,
    ShowId TEXT NOT NULL,
    Week INTEGER NOT NULL,
    Audience INTEGER NOT NULL,
    Reach INTEGER NOT NULL,
    ShowScore INTEGER NOT NULL,
    Stars INTEGER NOT NULL,
    Saturation INTEGER NOT NULL,
    CreatedAt TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ShowId) REFERENCES Shows(ShowId)
);

CREATE INDEX IF NOT EXISTS idx_audience_history_show_week ON AudienceHistory(ShowId, Week);
